<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landing Clima</title>
<link rel="stylesheet" href="style.css">
<style>
/* === Container & Flex === */
.container {
  display: flex;
  gap: 20px;
}
.item:nth-child(1) {
  width: 75%;
  flex-grow: 6;
  flex-shrink: 2;
  flex-basis: 4px;
  align-self: flex-start;
}
.item:nth-child(2) {
  width: 25%;
  flex-grow: 3;
  flex-shrink: 2;
  flex-basis: 4px;
  align-self: flex-start;
}

/* === Input Estilizado === */
.input-container {
  position: relative;
  width: 100%;
  max-width: 270px;
}
.input {
  width: 100%;
  height: 60px;
  padding: 12px;
  font-size: 18px;
  font-family: "Courier New", monospace;
  color: #000;
  background-color: #fff;
  border: 4px solid #000;
  outline: none;
  transition: all 0.3s ease;
  box-shadow: 8px 8px 0 #000;
}
.input::placeholder { color: #888; }
.input:hover { transform: translate(-4px,-4px); box-shadow: 12px 12px 0 #000; }
.input:focus { background-color: #010101; color: #fff; border-color: #d6d9dd; }
.input:focus::placeholder { color: #fff; }

/* === Toggle === */
.toggleWrapper { position: fixed; top: 20px; right: 20px; z-index: 1000; }
.toggleWrapper .input { position: absolute; left: -99em; }
.toggle { cursor: pointer; display: inline-block; position: relative; width: 90px; height: 50px; background-color: #83d8ff; border-radius: 84px; transition: background-color 200ms ease; }
.toggle__handler { display: inline-block; position: relative; z-index: 1; top: 3px; left: 3px; width: 44px; height: 44px; background-color: #ffcf96; border-radius: 50px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); transition: all 400ms ease; transform: rotate(-45deg); }
.toggle__handler .crater { position: absolute; background-color: #e8cda5; opacity: 0; transition: opacity 200ms ease-in-out; border-radius: 100%; }
.star { position: absolute; background-color: #fff; border-radius: 50%; transition: all 300ms ease; }
.input:checked + .toggle { background-color: #749dd6; }
.input:checked + .toggle .toggle__handler { background-color: #ffe5b5; transform: translate3d(40px,0,0) rotate(0); }
.input:checked + .toggle .toggle__handler .crater { opacity: 1; }

/* === Dark Mode === */
.dark-mode { background-color: #0d0d0d; color: #fff; transition: background-color 0.5s ease, color 0.5s ease; }
.dark-mode .input { background-color: #000; color: #fff; border-color: #fff; box-shadow: 8px 8px 0 #fff; }
.dark-mode .input::placeholder { color: #bbb; }
.dark-mode .glass { border-color: rgba(255,255,255,0.3); }

/* === Weather Cards === */
#weather { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 100px; gap: 10px; }
/* Apariencia por defecto (dÃ­a): fondo claro y texto oscuro para legibilidad */
.glass {
  background: rgba(255,255,255,0.9);
  border: 1px solid rgba(0,0,0,0.08);
  backdrop-filter: blur(6px);
  color: #111;
  padding: 12px;
  border-radius: 12px;
  text-align: center;
  min-width: 80px;
}

/* En modo oscuro sobreescribimos a fondo translÃºcido y texto claro */
.dark-mode .glass {
  background: rgba(255,255,255,0.05);
  border-color: rgba(255,255,255,0.2);
  color: #fff;
}

/* Icono de clima dentro de la tarjeta */
.weather-icon {
  font-size: 28px;
  display: block;
  margin-bottom: 6px;
}
</style>
</head>
<body>

<div class="container">
  <div class="item">
    <div class="input-container">
      <input class="input" name="text" type="text" placeholder="El clima de hoy es ..." />
    </div>
  </div>
  <div class="item">
    <div class="toggleWrapper">
      <input class="input" id="dn" type="checkbox" />
      <label class="toggle" for="dn">
        <span class="toggle__handler">
          <span class="crater crater--1"></span>
          <span class="crater crater--2"></span>
          <span class="crater crater--3"></span>
        </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
      </label>
    </div>
  </div>
</div>

<!-- Contenedor Clima -->
<div id="weather"></div>

<script>
/* Detectar dÃ­a/noche al cargar y permitir alternar manualmente */
const toggle = document.getElementById("dn");
const weatherContainer = document.getElementById('weather');

function applyMode(isNight) {
  document.body.classList.toggle('dark-mode', isNight);
  toggle.checked = isNight;
}

// Determinar si ahora es noche (19-23h o 0-5h)
const now = new Date();
const currentHour = now.getHours();
const initialIsNight = (currentHour >= 19 && currentHour <= 23) || (currentHour >= 0 && currentHour <= 5);
applyMode(initialIsNight);

toggle.addEventListener("change", () => {
  // Al cambiar manualmente, alternar clase y recargar las horas mostradas
  document.body.classList.toggle("dark-mode", toggle.checked);
  fetchWeather();
});

/* Weather Open-Meteo */
async function fetchWeather() {
  const lat = -16.5; // La Paz
  const lon = -68.15;

  try {
    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,weathercode&timezone=auto`);
    const data = await res.json();
    const hours = data.hourly.time;
    const temps = data.hourly.temperature_2m;
    const codes = data.hourly.weathercode || [];

    showWeather(hours, temps, codes);
  } catch (err) {
    console.error('Error fetching weather:', err);
    weatherContainer.innerHTML = '<div class="glass">No se pudo cargar el clima.</div>';
  }
}

function getWeatherIcon(code, isNight) {

  if (code === 0) return isNight ? 'ðŸŒ™' : 'â˜€ï¸';
  if (code >= 1 && code <= 3) return isNight ? 'ðŸŒ¤ï¸' : 'â›…';
  if (code === 45 || code === 48) return 'ðŸŒ«ï¸';
  if (code >= 51 && code <= 67) return 'ðŸŒ¦ï¸';
  if (code >= 71 && code <= 77) return 'â„ï¸';
  if (code >= 80 && code <= 82) return 'ðŸŒ§ï¸';
  if (code >= 95 && code <= 99) return 'â›ˆï¸';
  return 'ðŸŒˆ';
}

function showWeather(hours, temps, codes) {
  weatherContainer.innerHTML = '';
  
  const today = new Date();
  const todayStr = today.toISOString().slice(0, 10);
  
  // Arrays para ordenar las horas
  let nightHoursEvening = []; // 19-23
  let nightHoursMorning = []; // 00-05
  let dayHours = [];         // 06-18

  // Recolectar y clasificar las horas
  for (let i = 0; i < hours.length; i++) {
    const hourDate = new Date(hours[i]);
    const hourDateStr = hourDate.toISOString().slice(0, 10);
    
    if (hourDateStr !== todayStr) continue;
    
    const h = hourDate.getHours();
    const data = {
      hour: h,
      temp: temps[i],
      code: codes[i]
    };

    // Clasificar en tres grupos
    if (h >= 19 && h <= 23) {
      nightHoursEvening.push(data);
    } else if (h >= 0 && h <= 5) {
      nightHoursMorning.push(data);
    } else if (h >= 6 && h < 18) {
      dayHours.push(data);
    }
  }

  // Ordenar cada grupo
  nightHoursEvening.sort((a, b) => a.hour - b.hour);
  nightHoursMorning.sort((a, b) => a.hour - b.hour);
  dayHours.sort((a, b) => a.hour - b.hour);

  // Mostrar las horas segÃºn el modo
  let hoursToShow = [];
  if (toggle.checked) {
    // En modo noche: concatenar primero tarde/noche (19-23) y luego madrugada (00-05)
    hoursToShow = [...nightHoursEvening, ...nightHoursMorning];
  } else {
    hoursToShow = dayHours;
  }
  
  hoursToShow.forEach(item => {
    const card = document.createElement('div');
    card.className = 'glass';
    const icon = getWeatherIcon(item.code, toggle.checked);
    card.innerHTML = `
      <span class="weather-icon">${icon}</span>
      <p>${String(item.hour).padStart(2,'0')}:00</p>
      <h2>${item.temp}Â°C</h2>
    `;
    weatherContainer.appendChild(card);
  });

  if (!weatherContainer.hasChildNodes()) {
    weatherContainer.innerHTML = '<div class="glass">No hay datos horarios para hoy.</div>';
  }
}

// Primera carga
fetchWeather();
</script>
</body>
</html>
